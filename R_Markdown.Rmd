---
title: "BGNVisualization"
author: "Bennett Stillerman"
date: "3/17/2021"
output:
  pdf_document: default
  html_document: default
---
```{r, include = FALSE}
library(tidyverse)
library(tinytex)
library(knitr)
library(readxl)

acgr <- read_excel("ACGR_statedata.xlsx")
ACGR_state_longformat <- read_excel("ACGR_state_longformat.xlsx")
```


```{r}
ACGR_state_longformat$acgr <- as.numeric(as.character(unlist(ACGR_state_longformat$acgr)))

states = unique(ACGR_state_longformat$state)
state_ACGR_plots = list()

for (state_ in states) {
  state_ACGR_plots[[state_]] = ggplot(ACGR_state_longformat %>% filter(state == state_ & acgr != "NA"), aes(x = year, y = acgr)) + geom_point() + geom_smooth(method = "lm") + theme_bw() + ggtitle(state_) + ylab("ACGR for available data") + xlab("Year") 
  
  print(state_ACGR_plots[state_])
  
}

```


```{r}
acgr_long_subgroups <- acgr %>% 
  gather(race, acgr, ACGR_black:ACGR_white) %>% 
  select(statename, race, acgr) 

acgr_long_subgroups$race <- as.factor(acgr_long_subgroups$race)


```

```{r}
acgr_long_subgroups <- acgr_long_subgroups %>% 
  mutate(National_avg = case_when(
    statename == "United States" ~ "National average",
    statename != "United States" ~ "State average") %>% 
      as.factor() %>% 
      structure(levels = c("National average", "State average"))
  )


states2 = unique(acgr_long_subgroups$statename)
state_subgroup_bar = list()

for (i in states2) {
  state_subgroup_bar[[i]] = ggplot(acgr_long_subgroups %>% filter(statename == i|statename == "United States"), aes(x = race, y = acgr, fill = National_avg)) + geom_bar(position = "dodge", stat = "identity", width = 0.5) + theme_bw() + xlab("Subgroup") + ylab("ACGR") + ggtitle(i) + coord_flip()
  
  print(state_subgroup_bar[i])
  
}

```



